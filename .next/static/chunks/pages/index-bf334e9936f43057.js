(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(4186)}])},4186:function(e,t,n){"use strict";n.r(t),n.d(t,{VideoPlayer:function(){return d},default:function(){return h}});var a=n(5893),i=n(9008),o=n.n(i),c=n(7294),r=n(1502),s=n.n(r);function l(e){return fetch("/api/rooms/".concat(e),{method:"PUT"}).then(e=>e.json())}let d=e=>{let{videoTrack:t,style:n}=e,i=(0,c.useRef)(null);return(0,c.useEffect)(()=>{let e=i.current;if(t&&e)return t.play(e),()=>{t.stop()}},[t]),(0,a.jsx)("div",{ref:i,style:n})};async function u(e,t,a,i,o,c){let{default:r}=await Promise.all([n.e(344),n.e(594)]).then(n.t.bind(n,8424,23)),s=r.createClient({mode:"rtc",codec:"vp8"});await s.join("f84852acf83c43938bac98f4bfbd1e94",e,c,t),s.on("user-left",async t=>{console.log("User left: ".concat(t.uid)),await l(e)}),s.on("user-published",(e,t)=>{s.subscribe(e,t).then(()=>{if("video"===t&&a(e.videoTrack),"audio"===t){var n;o(e.audioTrack),null===(n=e.audioTrack)||void 0===n||n.play()}})});let d=await r.createMicrophoneAndCameraTracks();return i(d[1]),await s.publish(d),{tracks:d,client:s}}async function _(e,t,a,i){let{default:o}=await Promise.all([n.e(756),n.e(454)]).then(n.t.bind(n,6278,23)),c=o.createInstance("f84852acf83c43938bac98f4bfbd1e94");await c.login({uid:t,token:i});let r=await c.createChannel(e);return await r.join(),r.on("ChannelMessage",(e,t)=>{a({userId:t,message:e.text})}),{channel:r}}function h(){let[e]=(0,c.useState)(parseInt("".concat(1e6*Math.random()))+""),[t,n]=(0,c.useState)(),[i,r]=(0,c.useState)([]),[h,f]=(0,c.useState)(""),[m,w]=(0,c.useState)(),[v,j]=(0,c.useState)(),[p,x]=(0,c.useState)(),b=(0,c.useRef)(),g=(0,c.useRef)();async function k(){x(void 0),w(void 0),j(void 0),r([]),b.current&&await b.current.leave(),g.current&&g.current.leave();let{rooms:a,rtcToken:i,rtmToken:o}=await fetch("/api/rooms?userId=".concat(e)).then(e=>e.json());if(t&&l(t._id),a.length>0){n(a[0]);let{channel:c}=await _(a[0]._id,e,e=>r(t=>[...t,e]),o);b.current=c;let{tracks:s,client:d}=await u(a[0]._id,e,e=>w(e),e=>j(e),e=>x(e),i);g.current=d}else{let{room:h,rtcToken:f,rtmToken:m}=await fetch("/api/rooms?userId=".concat(e),{method:"POST"}).then(e=>e.json());n(h);let{channel:v}=await _(h._id,e,e=>r(t=>[...t,e]),m);b.current=v;let{tracks:p,client:k}=await u(h._id,e,e=>w(e),e=>j(e),e=>x(e),f);g.current=k}}return(0,c.useEffect)(()=>{k()},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o(),{children:[(0,a.jsx)("title",{children:"Cyber Mingle"}),(0,a.jsx)("meta",{name:"description",content:"Meet with other personas!"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsx)("main",{className:s().main,children:t?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"chat-window",children:[(0,a.jsxs)("div",{className:"video-panel",children:[(0,a.jsx)("div",{className:"video-stream",children:v&&(0,a.jsx)(d,{style:{width:"100%",height:"100%"},videoTrack:v})}),(0,a.jsx)("div",{className:"video-stream",children:m&&(0,a.jsx)(d,{style:{width:"100%",height:"100%"},videoTrack:m})})]}),(0,a.jsx)("button",{className:"next-button",onClick:function(){k()},children:"Next Button"}),"room id: ",t._id," status: ",t.status]})}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("button",{onClick:function(){k()},children:"Start Chatting"})})})]})}},1502:function(e){e.exports={main:"Home_main__nLjiQ",description:"Home_description__41Owk",code:"Home_code__suPER",grid:"Home_grid__GxQ85",card:"Home_card___LpL1",center:"Home_center__4BFgC",logo:"Home_logo__27_tb",thirteen:"Home_thirteen__cMI_k",rotate:"Home_rotate____XsI",content:"Home_content__Zy02X",vercelLogo:"Home_vercelLogo__dtSk9"}},9008:function(e,t,n){e.exports=n(3121)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);